angular.module( 'myAngularWeb', [ 'ngRoute', 'controllers', 'config', 'services' ] )
angular.module( 'config', [ ] )
    .config( function( $routeProvider ){
            $routeProvider
                .when('/',{
                    templateUrl: 'modules/home/home.html',
                    controller: 'generalController'
                })
                .when('/home',{
                    templateUrl: 'modules/home/home.html',
                    controller: 'generalController'
                })
                .when('/error',{
                    templateUrl: 'modules/error/error.html',
                    controller: 'generalController'
                })
                .when('/info/:USER',{
                    templateUrl: 'modules/info/info.html',
                    controller: 'infoController'
                })
                .otherwise({ redirectTo: '/' }); ;
    })
angular.module( 'controllers', [ 'generalModule', 'infoModule' ] )
angular.module( 'generalModule', [ ] )

    .controller( 'generalController' , function ( $scope, $rootScope, $http, urlService, $location ) {

    	$scope.resultsSearchedUser = '';
    	$rootScope.bioUser = '';

    	$scope.submit = function() {

	    	urlService.getInfoUser( $scope.memberToSearch )
				.then( function( dataUserSearched ) {
					$scope.resultsSearchedUser = dataUserSearched.data.items[0];
					if($scope.resultsSearchedUser === undefined){
						$location.path( "/error" );
					} else {
						urlService.getBioUser( $scope.memberToSearch )
							.then( function( dataBioSearched ) {
								$rootScope.bioUser = dataBioSearched.data;
								$location.path( "/info/" + dataBioSearched.data.login );
							})
					}
				})
		}

    })
angular.module( 'services', [ 'urlService', 'infoService' ] );

angular.module( 'urlService', [ ] )

	.factory('urlService', function($http) {

        var urlApi = 'https://api.github.com/search/users?q=<SEARCH>';
        function getInfoUser ( userToSearch ) {
            var urlApiWithUser = urlApi.replace( '<SEARCH>', userToSearch )
            return $http.get( urlApiWithUser );
        }

        var urlBio = 'https://api.github.com/users/<SEARCH>';
        function getBioUser ( userToSearch ) {
            var urlBioWithUser = urlBio.replace( '<SEARCH>', userToSearch )
            return $http.get( urlBioWithUser );
        }

        return {
            getInfoUser : getInfoUser,
            getBioUser : getBioUser
        }
        
        
    })
angular.module( 'infoModule', [ ] )

    .controller( 'infoController' , function ( $scope, $routeParams, $rootScope, infoService, urlService, $location ) {

    	$scope.resultsSearchedRepos = '';
    	var userName = $routeParams.USER;

    	infoService.getReposUser( userName )
    		.then( function( dataReposSearched ) {
				$scope.resultsSearchedRepos = dataReposSearched.data;
			})


    	$scope.resultsSearchedUser = '';

    	$scope.submit = function() {

	    	urlService.getInfoUser( $scope.memberToSearch )
				.then( function( dataUserSearched ) {
					$scope.resultsSearchedUser = dataUserSearched.data.items[0];
					if($scope.resultsSearchedUser === undefined){
						$location.path( "/error" );
					} else {
						urlService.getBioUser( $scope.memberToSearch )
							.then( function( dataBioSearched ) {
								$rootScope.bioUser = dataBioSearched.data;
								$location.path( "/info/" + dataBioSearched.data.login );
							})
					}
				})
		}

    })
angular.module( 'infoService', [ ] )

    .factory('infoService', function($http) {

        var urlRepos = 'https://api.github.com/users/<SEARCH>/repos';
        function getReposUser ( userGetRepos ) {
            var urlReposWithUser = urlRepos.replace( '<SEARCH>', userGetRepos );
            return $http.get( urlReposWithUser );
        }

        return {
            getReposUser : getReposUser
        }
        
    })